"use strict";var _createClass=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}();function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var SubscribtionForm=function(){function t(e){_classCallCheck(this,t),this.form=e,this.email=e.querySelector(".subscribtion-form__email"),this.isValid=this.isValid.bind(this)}return _createClass(t,[{key:"init",value:function(){var t=this;this.form.addEventListener("submit",function(e){t.isValid()||(e.preventDefault(),alert("Некорректный E-mail"))})}},{key:"isValid",value:function(){return/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(this.email.value)}}]),t}(),MainMenu=function(){function t(e){_classCallCheck(this,t),this.menu=e,this.hamburger=e.querySelector(".main-menu__hamburger"),this.menuList=e.querySelector(".main-menu__list"),this.init=this.init.bind(this),this.toggleMenu=this.toggleMenu.bind(this)}return _createClass(t,[{key:"init",value:function(){var t=this;this.hamburger.addEventListener("click",function(e){e.preventDefault(),t.toggleMenu()})}},{key:"toggleMenu",value:function(){this.menuList.classList.toggle("main-menu__list--show")}}]),t}(),smoothScroll=function(t){var e=-window.pageYOffset/(t/16),i=void 0;i=e>=0?function(){var t=window.pageYOffset;(t>=0-e||window.innerHeight+t>=document.body.offsetHeight)&&clearInterval(n)}:function(){window.pageYOffset<=0&&clearInterval(n)};var n=setInterval(function(){window.scrollBy(0,e),i()},16)},ToTopButton=function(){function t(e){_classCallCheck(this,t),this.button=e,window.pageYOffset>50&&this.button.classList.contains("visually-hidden")&&this.button.classList.remove("visually-hidden"),this.init=this.init.bind(this)}return _createClass(t,[{key:"init",value:function(){var t=this;this.button.addEventListener("click",function(t){t.preventDefault(),smoothScroll(500)}),window.addEventListener("scroll",function(e){window.pageYOffset>50?t.button.classList.contains("visually-hidden")&&t.button.classList.remove("visually-hidden"):t.button.classList.contains("visually-hidden")||t.button.classList.add("visually-hidden")})}}]),t}(),Catalog=function(){function t(e){_classCallCheck(this,t),this.catalog=e,this.priceSortButton=e.querySelector("#price-sort"),this.roomsSortButton=e.querySelector("#rooms-sort"),this.catalogList=e.querySelector(".catalog__apartment-list"),this.moreButton=e.querySelector(".catalog__more .button"),this.init=this.init.bind(this),this.toggleState=this.toggleState.bind(this),this.sort=this.sort.bind(this),this.render=this.render.bind(this)}return _createClass(t,[{key:"init",value:function(){var t=this,e=["catalog__sort-type--active","catalog__sort-type--inc","catalog__sort-type--dec"];this.priceSortButton.addEventListener("click",function(i){i.preventDefault(),e.forEach(function(e){t.roomsSortButton.classList.contains(e)&&t.roomsSortButton.classList.remove(e)}),t.toggleState(i.target);var n={type:"price",direction:i.target.classList.contains("catalog__sort-type--inc")?"inc":"dec"};t.sort(n)}),this.roomsSortButton.addEventListener("click",function(i){i.preventDefault(),e.forEach(function(e){t.priceSortButton.classList.contains(e)&&t.priceSortButton.classList.remove(e)}),t.toggleState(i.target);var n={type:"rooms",direction:i.target.classList.contains("catalog__sort-type--inc")?"inc":"dec"};t.sort(n)}),this.moreButton.addEventListener("click",function(e){e.preventDefault();var i=new XMLHttpRequest;i.open("GET","http://localhost:3010/apartments/20"),i.addEventListener("readystatechange",function(e){if(i.readyState===i.DONE){var n=JSON.parse(i.response).items;t.render(n)}}),i.send(null)})}},{key:"toggleState",value:function(t){t.classList.contains("catalog__sort-type--active")?t.classList.contains("catalog__sort-type--inc")?(t.classList.remove("catalog__sort-type--inc"),t.classList.add("catalog__sort-type--dec")):(t.classList.remove("catalog__sort-type--dec"),t.classList.add("catalog__sort-type--inc")):(t.classList.add("catalog__sort-type--active"),t.classList.add("catalog__sort-type--inc"))}},{key:"sort",value:function(t){var e=Array.prototype.slice.call(this.catalogList.querySelectorAll(".apartment-item")),i=[];e.forEach(function(t){i.push({image:t.querySelector(".apartment-item__image img").src,title:t.querySelector(".apartment-item__title").innerText,finish:t.querySelector(".apartment-item__property--finish").innerText,square:t.querySelector(".apartment-item__property--square").innerText.match(/\d+/)[0],floor:t.querySelector(".apartment-item__property--floor").innerText.match(/\d+\/\d+/)[0],price:parseInt(t.querySelector(".apartment-item__price").innerText.replace(/\s/g,"")),status:t.querySelector(".apartment-item__status").innerText,roomsCount:Number(t.dataset.roomsCount)})}),i.sort(function(e,i){return"price"===t.type?"inc"===t.direction?e.price-i.price:i.price-e.price:"rooms"===t.type?"inc"===t.direction?e.roomsCount-i.roomsCount:i.roomsCount-e.roomsCount:void 0}),i.forEach(function(t){t.price=String(t.price);for(var e="",i=0,n=t.price.length-1;n>=0;n--)e=t.price[n]+e,2===i&&n!==t.price.length?(e=" "+e,i=0):i++;t.price=e}),this.catalogList.innerHTML="",this.render(i)}},{key:"render",value:function(t){var e=document.createDocumentFragment(),i=document.querySelector("#apartment-item-template").innerHTML;Mustache.parse(i),t.forEach(function(t){var n=Mustache.render(i,t),a=document.createElement("li");switch(a.classList.add("catalog__apartment-item"),a.innerHTML=n,t.status){case"Забронировано":a.querySelector(".apartment-item").classList.add("apartment-item--booked"),a.querySelector(".apartment-item__status").classList.add("apartment-item__status--booked");break;case"Свободно":a.querySelector(".apartment-item").classList.add("apartment-item--free"),a.querySelector(".apartment-item__status").classList.add("apartment-item__status--free");break;case"Продано":a.querySelector(".apartment-item").classList.add("apartment-item--sold-out"),a.querySelector(".apartment-item__status").classList.add("apartment-item__status--sold-out")}e.appendChild(a)}),this.catalogList.appendChild(e)}}]),t}(),mainMenuElement=document.querySelector(".main-menu"),mainMenu=new MainMenu(mainMenuElement);mainMenu.init();var subscribtionFormElement=document.querySelector(".subscribtion-form"),subscribtionForm=new SubscribtionForm(subscribtionFormElement);subscribtionForm.init();var toTopButtonElement=document.querySelector(".to-top-button"),toTopButton=new ToTopButton(toTopButtonElement);toTopButton.init();var catalogElement=document.querySelector(".catalog"),catalog=new Catalog(catalogElement);catalog.init();